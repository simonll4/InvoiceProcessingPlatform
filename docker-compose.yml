services:
  pipeline-api:
    build:
      context: ./services/ocr-pipeline-python
      dockerfile: Dockerfile
    container_name: pipeline-api
    restart: unless-stopped
    ports:
      - "${API_HOST_PORT:-7001}:8000"
    env_file:
      - ./services/ocr-pipeline-python/.env
    volumes:
      - ./data:/app/data
      - ./datasets:/app/datasets:ro

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  invoice-agent-api:
    build:
      context: ./services/invoice-agent-python
      dockerfile: Dockerfile
    container_name: invoice-agent-api
    restart: unless-stopped
    ports:
      - "7003:7003"
    env_file:
      - ./services/invoice-agent-python/.env
    networks:
      - default
    depends_on:
      - mcp-sqlite
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7003/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  mcp-sqlite:
    build:
      context: ./services/sqlite-mcp-server
      dockerfile: Dockerfile
    container_name: mcp-sqlite
    restart: unless-stopped
    ports:
      - "7002:7002"
    env_file:
      - ./services/sqlite-mcp-server/.env
    volumes:
      - ./data:/app/data:ro

  web-ui:
    build:
      context: ./services/web-ui
      dockerfile: Dockerfile
    container_name: web-ui
    restart: unless-stopped
    depends_on:
      - pipeline-api
      - invoice-agent-api
    ports:
      - "${HOST_PORT:-7000}:80"
